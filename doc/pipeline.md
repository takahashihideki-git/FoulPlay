# Pipeline

Pipeline は、複数のテキストファイルの内容を、専用のスクリプトによって一挙に書き換えるような、一括変換作業に奉仕する "GUIコンソール" アプリです。

Pipeline は、ローカルファイルシステムの特定のフォルダを対象にして動作します。一括変換作業の実行者は、Pipeline で任意のフォルダを開き、次の3つの操作パネルの設定を通じて、変換作業のシナリオを決定します。

「Selector」で、一括変換の対象となるテキストファイルを選択します。

「Filters」で、変換を行うスクリプトファイルを指定し、複数のスクリプトファイルを指定した場合は、実行順序を設定します。

「Terminator」 で、変換結果の出力方法を設定します。

Pipeline は、このように、一括変換作業のシナリオを条件や目的に応じて実行者が自由に設定できるようにすることで、テキストの変換を行うスクリプトの責任を軽減します。

Pipeline を前提にしたスクリプトは、作業のコンテクストのことは度外視して、UNIX のコマンドのような"単一責任の原則"の下で、まさに目の前に与えられたテキストの書き換えのみに専念すればよいことになります。
つまり、開発のしやすさ、拡張のしやすさ、保守のしやすさ、再利用のしやすさが高まります。

ひとつひとつはいたって単純なスクリプトの組み合わせを工夫することで、総体としてみれば相当に複雑な一括変換作業をこなすこともできるようになるでしょう。
こうして、Pipelineは結局、この種の一括変換作業環境の構築そのものを、たとえ一度きりで使い捨てても少しも惜しくないほど気軽でカジュアルなものにします。

## 使い方

### Foul にショートカットを登録

下記の URL を Foul のアドレス欄に入力して表示します。表示されたら、アドレス欄の右にある + ボタンをクリックして、ショートカットに登録します。

その後、リロードするか、ホーム画面に追加されたアイコンをクリックして再表示すると、ローカルファイルシステムにアクセスできるようになります。

### root フォルダを選択

書き換えの対象となるテキストファイルと、書き換えを行うスクリプトファイルが含まれたフォルダを選択します。

Select ボタンをクリックすると、フォルダ選択ダイアログが開きます。

フォルダを選択すると、下位階層のファイルとフォルダが Selector 欄に読み込まれます。

### 書き換え対象となるテキストファイルを選択

Selector 欄から、書き換え対象となるテキストファイルを選択します。ファイル名の前にあるチェックボックスをチェックします。

フォルダ名の前にあるチェックボックスをチェックすると、そのフォルダ以下に存在するすべてのファイルが選択されます。

### スクリプトファイルを選択

Selector 欄から、スクリプトファイルを選んで、Filters 欄にドラッグアンドドロップで移動します。

複数のスクリプトファイルを Filters 欄に移動して、順番に実行することができます。

Filters 欄でスクリプトファイルをドラッグして、実行の順序を変更することができます。

ファイル名の前にあるチェックボックスのチェックを外したスクリプトファイルは実行されません。

#### スクリプトファイルの書き方

filter 関数を定義します。

    var filter = function ( content, context, next ) {

        // content の書き換え
        content = content.replace( /foo/g, "bar"  );
        // 書き換えた content を後続の処理に引き渡す
        next( content );

    }

filter 関数には、次の引数が渡されます。

 * 第一引数: Selector 欄で選択されたファイルの内容

 * 第二引数: 次の内容の処理コンテキストオブジェクト

    { 
        path: ファイルのパス
        info: ファイルの情報　https://github.com/takahashihideki-git/Foul/wiki/window.fileSystem#successfunction-pathstring-filesarray-
        currentFileCount:　全処理対象ファイル中の処理順　1 〜
        globalContext: {
            path: Pipelneが適用されたフォルダのパス
            totalFileCount: 全処理対象ファイル数 
        }
    }

    globalContext は、全ファイルの処理に共通のオブジェクトです。ここに適当な key value をセットして、後続のファイルの処理に任意の値を引き渡すことができます。

 * 第三引数: 次のフィルターまたはターミネータに処理を引き継ぐためのコールバック関数

filter 関数は、必ず、第三引数に渡された next 関数に、引数として書き換え後のファイルの内容を与えて実行しなければなりません。

# ターミネーターを設定

# Run !

# フィルターがfalseを返せば

next関数の引数に false を与えて実行すると、当該のファイルに対する処理は、その時点で中断します。

# フィルターで外部のライブラリーを使いたいとき

外部の Javascript ライブラリーを使用するには、dependencies 配列を定義します。


# もっと凝ったターミネーターが必要なら

# foul = 事実上の node.js だから、なんでもできる。

# リフレッシュ

# 設定の保存

# Pipeline.log, Pipeline.error

# ケーススタディー

* マークダウンファイルの内容を HTML に変換しつつ、
* 所定のテンプレートを適用して、HTMLファイルとして保存しつつ、
* 出来上がったHTMLファイルの一覧をRSS形式で出力
